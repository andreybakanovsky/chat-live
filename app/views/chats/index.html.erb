<div id="user-id" data-user-id="<%= current_user.id %>"></div>
<div id="chat-token" data-chat-token="<%= @token %>"></div>
<%= turbo_stream_from :appearance_channel %>
<%= turbo_stream_from :message_status %>
<div class="container-fluid">
  <div class="row">
    <div class="col-3 charts-sidebar">
      <% users.each do |user| %>
        <%= link_to chat_path(user.id), class: 'chat-link' do %>
          <% active_class = (@recipient == user) ? 'active' : '' %>
          <div class="card no-outline mb-2 chart-card <%= active_class %>">
            <div class="card-body">
              <span class='name'><%= user.name %></span><br>
              <%= render "users/online_status", user: user %>
              <% if !user.as_common_chat? %>
                <%= render "messages/new_messages_number", recipient_id: current_user.id,  sender_id: user.id %>
              <% end %>
            </div>
          </div>
        <% end %>
      <% end %>
    </div>
    <div class="col-9">
      <% if @recipient.present? %>
        <div class="chat-space">
          <nav class="navbar navbar-light">
            <span class="navbar-brand px-3" href="#">
              <%= @recipient.name %>
            </span>
          </nav>
          <div id="messages" user=<%= @recipient.id %>>
            <% @users_messages.each do |message| %>
              <%= render 'messages/message', message: message %>
              <div class="space"></div>
            <% end %>
          </div>
          <div class="chat-box">
            <%= render 'messages/form', message: Message.new, recipient: @recipient, token: @token %>
          </div>
        </div>
      <% else %>
        <h3 class="mt-5 text-secondary">Welcome to our Live Chat!</h3>
      <% end %>
    </div>
  </div>
</div>
